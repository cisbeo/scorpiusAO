# üìö RAG Knowledge Base - Tenders Historiques

**Date**: 2 octobre 2025
**Version**: 1.0
**Objectif**: D√©finir comment int√©grer les appels d'offres pass√©s dans la Knowledge Base

---

## üéØ Probl√©matique

Actuellement, la KB stocke uniquement les **r√©ponses gagnantes** (`past_proposals`). Cependant, pour maximiser l'apprentissage et la pertinence des suggestions RAG, il faut √©galement stocker les **appels d'offres originaux** (tenders) qui ont donn√© lieu √† ces r√©ponses.

### Pourquoi Stocker les Tenders Historiques ?

#### 1. **Matching Contextuel Am√©lior√©**
Permet de comparer le tender actuel avec des tenders pass√©s similaires et retrouver:
- Les r√©ponses qui ont fonctionn√© sur des AO similaires
- Les strat√©gies gagnantes par type de tender
- Les pi√®ges √† √©viter (crit√®res sous-estim√©s, exigences cach√©es)

#### 2. **Apprendre des √âchecs**
Stocker aussi les **tenders perdus** permet de:
- Identifier pourquoi une r√©ponse a √©chou√©
- Comparer r√©ponse gagnante vs r√©ponse perdante sur m√™me type d'AO
- √âviter de reproduire les m√™mes erreurs

#### 3. **Analyse Comparative**
Comparer les crit√®res d'√©valuation:
- √âvolution des crit√®res dans le temps
- Poids technique vs financier par secteur
- Nouvelles exigences √©mergentes (cybers√©curit√©, RSE...)

#### 4. **Recherche S√©mantique Enrichie**
Rechercher dans les CCTP/RC pass√©s:
- "Quels tenders demandaient ISO 27001 ?"
- "R√©f√©rences aux processus ITIL dans les AO sant√©"
- "√âvolution des SLA dans les collectivit√©s"

---

## üóÇÔ∏è Sch√©ma de Donn√©es √âtendu

### Nouvelle Table: `historical_tenders`

**R√¥le**: Stocke les appels d'offres pass√©s avec lien vers les r√©ponses soumises

```sql
CREATE TABLE historical_tenders (
    -- Identit√©
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    kb_document_id UUID REFERENCES kb_documents(id) ON DELETE SET NULL,
    -- NULL si pas de document KB (juste m√©tadonn√©es)

    -- Informations Tender
    title VARCHAR(500) NOT NULL,
    organization VARCHAR(200) NOT NULL,
    organization_type VARCHAR(100),  -- EPT, Mairie, D√©partement, H√¥pital...
    reference_number VARCHAR(100),
    publication_date DATE,
    deadline DATE NOT NULL,

    -- Secteur & Contexte
    sector VARCHAR(100),  -- Collectivit√©, Sant√©, √âducation, Industrie...
    geographic_zone VARCHAR(200),  -- √éle-de-France, PACA, National...

    -- Taille Organisation
    estimated_users INT,  -- Nombre utilisateurs finaux
    estimated_sites INT,  -- Nombre sites/implantations
    estimated_budget DECIMAL(15,2),  -- Budget estim√© (‚Ç¨)

    -- Type March√©
    contract_type VARCHAR(100),  -- Infog√©rance, Support, H√©bergement, TMA...
    contract_duration_months INT,
    contract_renewal_possible BOOLEAN,

    -- Proc√©dure
    procedure_type VARCHAR(50),  -- Ouvert, Restreint, Dialogue comp√©titif...
    lot_number INT,  -- Si march√© √† lots
    total_lots INT,

    -- Services Demand√©s
    services JSONB DEFAULT '[]',
    -- ["Infog√©rance", "Support N1-N2", "H√©bergement", "Supervision"]

    -- Documents Tender
    documents JSONB DEFAULT '[]',
    -- [
    --   {"type": "CCTP", "kb_document_id": "uuid", "pages": 69},
    --   {"type": "CCAP", "kb_document_id": "uuid", "pages": 38},
    --   {"type": "RC", "kb_document_id": "uuid", "pages": 12}
    -- ]

    -- Crit√®res √âvaluation
    evaluation_criteria JSONB,
    -- {
    --   "technique": {"weight": 40, "sub_criteria": [...]},
    --   "financier": {"weight": 60, "sub_criteria": [...]},
    --   "rse": {"weight": 10, "sub_criteria": [...]}
    -- }

    -- Exigences Cl√©s
    mandatory_certifications JSONB DEFAULT '[]',
    -- ["ISO 27001", "HDS", "Qualiopi"]
    mandatory_references INT,  -- Nombre r√©f√©rences exig√©es
    min_team_size INT,

    -- Technologies Mentionn√©es
    technologies JSONB DEFAULT '[]',
    -- ["ServiceNow", "VMware", "Zabbix"] - outils impos√©s ou sugg√©r√©s

    -- Processus ITIL Demand√©s
    itil_processes JSONB DEFAULT '[]',
    -- ["Incident Management", "Change Management", "Problem Management"]

    -- Niveau Service (SLA)
    sla_requirements JSONB,
    -- {
    --   "availability": "99.7%",
    --   "p1_response_time": "15min",
    --   "p1_resolution_time": "4h"
    -- }

    -- R√©sultat Notre Participation
    participated BOOLEAN DEFAULT true,
    result VARCHAR(20) CHECK (result IN ('won', 'lost', 'abandoned', 'disqualified', 'not_submitted')),
    our_rank INT,  -- Notre classement (1 = gagnant)
    total_candidates INT,  -- Nombre total candidats
    our_score DECIMAL(5,2),  -- Notre note (/20 ou /100)
    winner_score DECIMAL(5,2),  -- Note du gagnant

    -- Lien vers Notre R√©ponse
    our_proposal_id UUID REFERENCES past_proposals(id) ON DELETE SET NULL,
    -- NULL si pas r√©pondu ou r√©ponse non archiv√©e

    -- Informations Gagnant (si connu)
    winner_name VARCHAR(200),
    winner_contract_value DECIMAL(15,2),

    -- Analyse Post-Mortem
    lessons_learned TEXT,  -- Pourquoi gagn√©/perdu, le√ßons apprises
    competitive_analysis TEXT,  -- Analyse concurrence
    difficulty_level VARCHAR(20) CHECK (difficulty_level IN ('easy', 'medium', 'hard', 'very_hard')),

    -- Source
    source_platform VARCHAR(50),  -- BOAMP, AWS PLACE, Achats-publics.fr...
    source_url VARCHAR(500),

    -- M√©tadonn√©es
    tags JSONB DEFAULT '[]',
    notes TEXT,

    -- Timestamps
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    archived_at TIMESTAMP,  -- Date archivage dans KB

    CONSTRAINT historical_tenders_pkey PRIMARY KEY (id)
);

-- Indexes
CREATE INDEX idx_historical_tenders_kb_document ON historical_tenders(kb_document_id);
CREATE INDEX idx_historical_tenders_organization ON historical_tenders(organization);
CREATE INDEX idx_historical_tenders_sector ON historical_tenders(sector);
CREATE INDEX idx_historical_tenders_deadline ON historical_tenders(deadline DESC);
CREATE INDEX idx_historical_tenders_result ON historical_tenders(result);
CREATE INDEX idx_historical_tenders_participated ON historical_tenders(participated);
CREATE INDEX idx_historical_tenders_our_proposal ON historical_tenders(our_proposal_id);
CREATE INDEX idx_historical_tenders_services ON historical_tenders USING GIN (services);
CREATE INDEX idx_historical_tenders_technologies ON historical_tenders USING GIN (technologies);
CREATE INDEX idx_historical_tenders_certifications ON historical_tenders USING GIN (mandatory_certifications);
CREATE INDEX idx_historical_tenders_tags ON historical_tenders USING GIN (tags);

-- Index composite pour recherche similaire
CREATE INDEX idx_historical_tenders_similarity ON historical_tenders(
    sector, contract_type, estimated_users, result
);
```

---

### Table Modifi√©e: `past_proposals` (avec lien tender)

Ajouter colonne pour lier √† `historical_tenders`:

```sql
ALTER TABLE past_proposals
ADD COLUMN historical_tender_id UUID REFERENCES historical_tenders(id) ON DELETE SET NULL;

-- Index
CREATE INDEX idx_past_proposals_historical_tender ON past_proposals(historical_tender_id);
```

**Bidirectionnalit√©**:
- `historical_tenders.our_proposal_id` ‚Üí `past_proposals.id`
- `past_proposals.historical_tender_id` ‚Üí `historical_tenders.id`

---

## üéØ Nouveaux Use Cases RAG

### Use Case #6: Analyse Comparative Tenders Similaires ‚≠ê‚≠ê‚≠ê‚≠ê

**Probl√®me**: Bid manager ne sait pas comment ce tender se compare aux AO pass√©s

**Solution RAG**:

```
1. Nouveau tender re√ßu ‚Üí Extraction contexte automatique:
   - Secteur: Collectivit√©
   - Taille: 1200 users
   - Services: Infog√©rance + Support N1
   - Budget estim√©: 600k‚Ç¨/an

2. RAG recherche dans historical_tenders:
   - Matching similarit√© s√©mantique (embedding CCTP)
   - Filtres m√©tadonn√©es (secteur, taille ¬±30%, services similaires)
   - Retourne Top 5 tenders les plus similaires

3. Pour chaque tender similaire:
   - Affiche crit√®res d'√©valuation compar√©s
   - Montre notre r√©sultat (gagn√©/perdu + score)
   - Sugg√®re strat√©gie gagnante si applicable

4. Dashboard comparatif:
   - "3 tenders similaires gagn√©s dans les 2 ans"
   - "Crit√®res techniques poids moyen: 42% (vs 40% ici)"
   - "SLA P1 typique: <15min (vs <20min demand√© ici)"
```

**UI Mockup**:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üìä Tenders Similaires Pass√©s                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ 5 tenders similaires trouv√©s (2020-2024)                   ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ ‚úÖ 1. EPT Val-de-Marne - Infog√©rance (2020)   Score: 95%  ‚îÇ
‚îÇ     Secteur: Collectivit√© ‚úì  |  1500 users ‚úì  |  WON üèÜ   ‚îÇ
‚îÇ     Notre score: 18.2/20 (1er/4)                           ‚îÇ
‚îÇ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ     ‚îÇ Crit√®res cl√©s:                                     ‚îÇ ‚îÇ
‚îÇ     ‚îÇ ‚Ä¢ Technique: 40% (vs 40% actuel) ‚úì                ‚îÇ ‚îÇ
‚îÇ     ‚îÇ ‚Ä¢ Financier: 60% (vs 60% actuel) ‚úì                ‚îÇ ‚îÇ
‚îÇ     ‚îÇ ‚Ä¢ ISO 27001 obligatoire (vs obligatoire) ‚úì        ‚îÇ ‚îÇ
‚îÇ     ‚îÇ ‚Ä¢ SLA P1: <15min (vs <20min actuel) ‚ö†Ô∏è Plus strict‚îÇ ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ     üí° Strat√©gie gagnante:                                 ‚îÇ
‚îÇ        - Mise en avant ITIL v4 (diff√©renciateur cl√©)      ‚îÇ
‚îÇ        - √âquipe 100% d√©di√©e (exigence implicite)          ‚îÇ
‚îÇ        - Prix agressif lots 1+2 combin√©s                  ‚îÇ
‚îÇ     [Voir r√©ponse gagnante] [Voir CCTP original]          ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ ‚ùå 2. Mairie Montreuil - Support IT (2022)    Score: 87%  ‚îÇ
‚îÇ     Secteur: Collectivit√© ‚úì  |  800 users ‚ö†Ô∏è  |  LOST ‚ùå  ‚îÇ
‚îÇ     Notre score: 16.5/20 (2√®me/5)                         ‚îÇ
‚îÇ     Gagnant: 17.8/20 (√©cart: -1.3 pts)                    ‚îÇ
‚îÇ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ     ‚îÇ Crit√®res cl√©s:                                     ‚îÇ ‚îÇ
‚îÇ     ‚îÇ ‚Ä¢ Technique: 30% (vs 40% actuel) ‚ö†Ô∏è Moins important‚îÇ ‚îÇ
‚îÇ     ‚îÇ ‚Ä¢ Financier: 70% (vs 60% actuel) ‚ö†Ô∏è Prix critique ‚îÇ ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ     ‚ö†Ô∏è  Le√ßons apprises:                                   ‚îÇ
‚îÇ        - Prix trop √©lev√© (-5 pts financier)               ‚îÇ
‚îÇ        - Manque r√©f√©rences collectivit√©s <1000 users      ‚îÇ
‚îÇ        - M√©thodologie trop complexe pour petit march√©     ‚îÇ
‚îÇ     [Voir r√©ponse soumise] [Voir analyse post-mortem]     ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ ‚úÖ 3. CD Seine-et-Marne - Infog√©rance (2023)  Score: 82%  ‚îÇ
‚îÇ     [...]                                                  ‚îÇ
‚îÇ                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üìà Analyse Comparative                                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ Taux succ√®s sur tenders similaires: 60% (3/5) ‚úÖ          ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ Crit√®res moyens tenders similaires:                        ‚îÇ
‚îÇ ‚Ä¢ Technique: 38% (actuel: 40%) ‚Üí L√©g√®rement + important   ‚îÇ
‚îÇ ‚Ä¢ Financier: 62% (actuel: 60%) ‚Üí Standard                 ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ SLA typiques:                                              ‚îÇ
‚îÇ ‚Ä¢ P1 response: <12min m√©diane (actuel: <20min) ‚ö†Ô∏è         ‚îÇ
‚îÇ ‚Ä¢ P1 resolution: 3h m√©diane (actuel: 4h) ‚úÖ               ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ Certifications demand√©es (fr√©quence):                      ‚îÇ
‚îÇ ‚Ä¢ ISO 27001: 100% (5/5) ‚Üí CRITIQUE                        ‚îÇ
‚îÇ ‚Ä¢ ISO 9001: 60% (3/5) ‚Üí Important                         ‚îÇ
‚îÇ ‚Ä¢ HDS: 20% (1/5) ‚Üí Optionnel                              ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ üí° Recommandations strat√©giques:                           ‚îÇ
‚îÇ 1. Mettre en avant notre taux succ√®s 60% sur AO similaires‚îÇ
‚îÇ 2. Anticiper n√©gociation SLA P1 (<20min peut √™tre n√©goci√©)‚îÇ
‚îÇ 3. Prix comp√©titif critique (‚â§650k‚Ç¨/an recommand√©)        ‚îÇ
‚îÇ 4. Insister sur r√©f√©rences EPT (diff√©renciateur cl√©)      ‚îÇ
‚îÇ                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Gain**: **2-3h** par tender (recherche manuelle + analyse comp√©titive)
**ROI**: **Tr√®s √©lev√©** (r√©duit risque √©chec)

---

### Use Case #7: Apprentissage des √âchecs ‚≠ê‚≠ê‚≠ê‚≠ê

**Probl√®me**: On reproduit les m√™mes erreurs sur des tenders similaires

**Solution RAG**:

```
1. D√©tection tender √† risque:
   RAG identifie tenders perdus similaires (secteur + taille + services)

2. Analyse des raisons d'√©chec:
   - Extraction "lessons_learned" des tenders perdus
   - Identification patterns d'√©chec r√©currents
   - Alertes proactives bid manager

3. Checklist personnalis√©e:
   G√©n√©ration checklist bas√©e sur √©checs pass√©s:
   ‚úì V√©rifier prix ‚â§ budget march√© (√©chec Montreuil 2022: prix trop √©lev√©)
   ‚úì Minimum 3 r√©f√©rences secteur identique (√©chec Lyon 2021)
   ‚úì √âquipe d√©di√©e mentionn√©e (√©chec APHP 2023)
```

**Exemple Alerte**:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ö†Ô∏è  ALERTE: Risques Identifi√©s (bas√©s sur historique)      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ üîç 3 tenders similaires perdus identifi√©s:                 ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ 1. Mairie Montreuil (2022) - Perdu 2√®me/5                 ‚îÇ
‚îÇ    Raison: Prix 18% au-dessus gagnant                     ‚îÇ
‚îÇ    ‚ö†Ô∏è  RISQUE: Budget actuel semble serr√© (600k‚Ç¨)         ‚îÇ
‚îÇ    üí° ACTION: Proposer 2 variantes (base + options)       ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ 2. R√©gion PACA (2021) - Perdu 3√®me/6                      ‚îÇ
‚îÇ    Raison: Manque r√©f√©rences collectivit√©s >1000 users    ‚îÇ
‚îÇ    ‚ö†Ô∏è  RISQUE: Seulement 1 r√©f√©rence >1000 users en KB    ‚îÇ
‚îÇ    üí° ACTION: Mettre en avant CD77 (2200 users)           ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ 3. APHP (2023) - Perdu 4√®me/7                             ‚îÇ
‚îÇ    Raison: √âquipe non d√©di√©e explicitement mentionn√©e     ‚îÇ
‚îÇ    ‚ö†Ô∏è  RISQUE: CCTP demande "√©quipe d√©di√©e" (art. 3.2)    ‚îÇ
‚îÇ    üí° ACTION: Insister section "Moyens humains" sur d√©di√© ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ [Voir analyses d√©taill√©es] [G√©n√©rer plan mitigation]      ‚îÇ
‚îÇ                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Gain**: **1-2h** + **R√©duction risque √©chec 20-30%**
**ROI**: **Tr√®s √©lev√©** (√©vite soumissions vou√©es √† l'√©chec)

---

## üîÑ Workflow d'Archivage

### Processus Automatis√©

```
1. Tender actif dans table `tenders` (syst√®me existant)
   ‚Üì
2. R√©ponse soumise ‚Üí Cr√©ation `proposals`
   ‚Üì
3. R√©sultat connu (gagn√©/perdu)
   ‚Üì
4. Archivage automatique dans KB:

   a) Cr√©er historical_tender:
      - Copier m√©tadonn√©es tender
      - Extraire crit√®res, exigences, SLA
      - Stocker r√©sultat (won/lost + score)

   b) Lier avec past_proposal:
      - Si gagn√©: marquer "won = true"
      - Si perdu: marquer "won = false" + raisons √©chec

   c) Cr√©er embeddings documents tender:
      - CCTP ‚Üí chunks ‚Üí embeddings
      - CCAP ‚Üí chunks ‚Üí embeddings
      - RC ‚Üí chunks ‚Üí embeddings

   d) Enrichir m√©tadonn√©es:
      - Tags automatiques (secteur, services, technologies)
      - Extraction lessons_learned (formulaire post-mortem)
      - Analyse comparative vs gagnant (si infos disponibles)
```

### Trigger Automatique

```sql
-- Fonction archivage automatique
CREATE OR REPLACE FUNCTION archive_tender_to_kb()
RETURNS TRIGGER AS $$
BEGIN
    -- Si statut passe √† 'completed' ou 'closed'
    IF NEW.status IN ('completed', 'closed') AND OLD.status NOT IN ('completed', 'closed') THEN
        -- Insertion dans historical_tenders
        INSERT INTO historical_tenders (
            title, organization, reference_number, deadline,
            sector, services, result, participated,
            -- ... autres champs
        )
        SELECT
            t.title, t.organization, t.reference_number, t.deadline,
            t.parsed_content->>'sector',
            t.parsed_content->'services',
            -- D√©terminer result depuis proposal
            CASE
                WHEN EXISTS (SELECT 1 FROM proposals p WHERE p.tender_id = t.id AND p.status = 'won') THEN 'won'
                WHEN EXISTS (SELECT 1 FROM proposals p WHERE p.tender_id = t.id AND p.status = 'lost') THEN 'lost'
                ELSE 'not_submitted'
            END,
            true  -- participated
        FROM tenders t
        WHERE t.id = NEW.id;

        -- Trigger cr√©ation embeddings asynchrone (Celery task)
        -- PERFORM pg_notify('archive_tender', NEW.id::text);
    END IF;

    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Trigger
CREATE TRIGGER trigger_archive_tender_to_kb
AFTER UPDATE ON tenders
FOR EACH ROW
EXECUTE FUNCTION archive_tender_to_kb();
```

---

## üìä Statistiques & Analytics

### Vue: Taux Succ√®s par Type Tender

```sql
CREATE VIEW v_success_rate_by_tender_type AS
SELECT
    sector,
    contract_type,
    COUNT(*) as total_tenders,
    SUM(CASE WHEN result = 'won' THEN 1 ELSE 0 END) as won_count,
    ROUND(100.0 * SUM(CASE WHEN result = 'won' THEN 1 ELSE 0 END) / COUNT(*), 2) as win_rate,
    AVG(CASE WHEN result = 'won' THEN our_score END) as avg_score_won,
    AVG(CASE WHEN result = 'lost' THEN our_score END) as avg_score_lost,
    AVG(CASE WHEN result = 'won' THEN our_rank END) as avg_rank_won
FROM historical_tenders
WHERE participated = true
  AND result IN ('won', 'lost')
GROUP BY sector, contract_type
ORDER BY win_rate DESC;
```

### Vue: √âvolution Crit√®res dans le Temps

```sql
CREATE VIEW v_evaluation_criteria_evolution AS
SELECT
    DATE_TRUNC('year', deadline) as year,
    sector,
    AVG((evaluation_criteria->'technique'->>'weight')::float) as avg_tech_weight,
    AVG((evaluation_criteria->'financier'->>'weight')::float) as avg_financial_weight,
    AVG((evaluation_criteria->'rse'->>'weight')::float) as avg_rse_weight,
    COUNT(*) as tender_count
FROM historical_tenders
WHERE evaluation_criteria IS NOT NULL
GROUP BY DATE_TRUNC('year', deadline), sector
ORDER BY year DESC, sector;
```

### Requ√™te: Top Raisons √âchecs

```sql
SELECT
    sector,
    COUNT(*) as lost_count,
    -- Extraction patterns textuels des lessons_learned
    jsonb_agg(DISTINCT jsonb_build_object(
        'tender', title,
        'lesson', lessons_learned
    )) as common_failure_reasons
FROM historical_tenders
WHERE result = 'lost'
  AND lessons_learned IS NOT NULL
GROUP BY sector
ORDER BY lost_count DESC;
```

---

## üéØ M√©triques de Succ√®s

### KPIs Nouveaux

| KPI | Objectif | Mesure |
|-----|----------|--------|
| **Taux archivage** | 100% | % tenders compl√©t√©s archiv√©s dans KB |
| **Compl√©tude post-mortem** | >80% | % tenders avec lessons_learned remplis |
| **Utilisation comparaisons** | >70% | % nouveaux tenders avec analyse comparative consult√©e |
| **R√©duction √©checs r√©p√©t√©s** | -30% | R√©duction tenders perdus pour m√™mes raisons |
| **Taux succ√®s global** | +10% | Am√©lioration win rate apr√®s 6 mois |

---

## üöÄ Plan Impl√©mentation

### Phase 1: Infrastructure (Semaine 1)
1. ‚úÖ Cr√©er table `historical_tenders`
2. ‚úÖ Modifier table `past_proposals` (ajout colonne)
3. ‚úÖ Cr√©er vues analytics
4. ‚úÖ D√©velopper trigger archivage automatique

### Phase 2: Embeddings Tenders (Semaine 2)
1. ‚úÖ Adapter RAG service pour embeddings tenders
2. ‚úÖ Task Celery archivage avec embeddings
3. ‚úÖ Tests sur 5-10 tenders historiques

### Phase 3: Use Cases (Semaine 3)
1. ‚úÖ Use Case #6: Analyse comparative
2. ‚úÖ Use Case #7: Apprentissage √©checs
3. ‚úÖ UI alertes et recommandations

### Phase 4: Analytics (Semaine 4)
1. ‚úÖ Dashboard taux succ√®s par secteur
2. ‚úÖ √âvolution crit√®res dans le temps
3. ‚úÖ Rapports post-mortem automatiques

---

## üìã Checklist Migration Donn√©es Historiques

Pour migrer tenders existants dans KB:

```python
# Script migration backend/scripts/migrate_historical_tenders.py

async def migrate_existing_tenders():
    """Migrer tenders existants (status = completed/closed) vers KB"""

    # 1. R√©cup√©rer tenders compl√©t√©s
    tenders = await db.execute(
        select(Tender).where(Tender.status.in_(['completed', 'closed']))
    )

    for tender in tenders:
        # 2. Cr√©er historical_tender
        historical = HistoricalTender(
            title=tender.title,
            organization=tender.organization,
            reference_number=tender.reference_number,
            deadline=tender.deadline,
            # ... extraire m√©tadonn√©es
        )

        # 3. Lier avec proposal si existe
        proposal = await db.execute(
            select(Proposal).where(Proposal.tender_id == tender.id)
        )
        if proposal:
            historical.our_proposal_id = proposal.id
            historical.result = 'won' if proposal.status == 'won' else 'lost'

        # 4. Cr√©er embeddings documents
        for doc in tender.documents:
            await rag_service.ingest_document(
                document_id=doc.id,
                content=doc.extracted_text,
                document_type='historical_tender',
                metadata={'tender_id': historical.id}
            )

        await db.commit()
```

---

## üí° Recommandations

### 1. Formulaire Post-Mortem Obligatoire

Apr√®s chaque tender (gagn√© ou perdu), formulaire structur√©:

```
üìù Analyse Post-Mortem Tender: {title}

R√©sultat: [x] Gagn√©  [ ] Perdu  [ ] Abandonn√©

Notre score: __/20    Rang: __/__    Gagnant score: __/20

Pourquoi gagn√©/perdu? (3-5 lignes)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                ‚îÇ
‚îÇ                                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Facteurs cl√©s succ√®s/√©chec:
‚òê Prix (trop √©lev√©/comp√©titif)
‚òê R√©f√©rences (suffisantes/insuffisantes)
‚òê √âquipe (d√©di√©e/mutualis√©e)
‚òê M√©thodologie (adapt√©e/trop complexe)
‚òê Certifications (toutes pr√©sentes/manquantes)
‚òê D√©lais (respect√©s/trop justes)
‚òê Autre: ________________

Le√ßons pour prochains tenders similaires:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2. Revue Trimestrielle Tenders Perdus

Analyser patterns:
- Tenders perdus par secteur
- Raisons r√©currentes d'√©chec
- Actions correctives √† mettre en place

### 3. Benchmark Concurrentiel

Stocker infos gagnants quand disponibles:
- Nom concurrent gagnant
- Prix gagnant (si publi√©)
- Points forts identifi√©s
- ‚Üí Constituer base connaissance concurrence

---

**Prochaine √©tape**: Cr√©er migration Alembic pour `historical_tenders`

**Derni√®re mise √† jour**: 2 octobre 2025
**Version**: 1.0
